---
author: renfakai
layout: post
title: 原创-订单引擎设计
date: 2020-04-25
categories: 支付
tags: [java，支付]
description: 订单引擎设计
---


## 如何设计订单引擎

背景:  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;订单引擎不支持多元化，旧版订单引擎为一段大Sql，大概有40行左右，里面包含了各种连接和连接后的判断，
为了回款率需要增加扣款批次，每次都需要将大Sql粘贴，新建Service。管理十分混乱，代码无法复用。  

解决方案:  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;订单引擎从Sql进行拆离，使用节点话，增加引擎32位模版(设计思想来自汇编的标志寄存器)，使引擎可配置。 
   
      
[参考达达京东到家技术](https://mp.weixin.qq.com/s/M1rK96Grc1QYlcivg2cO9w)

  
  
具体实现:  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在原有基础上增加了32位Path，进行订单卡槽设定和处理，设计思想来自汇编的标志寄存器。  
![avatar](/img/20200425/订单生成.png)      


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用一个单例的bean管理所有卡槽，根据path进行卡槽校验，由于各个节点之间级别相同，
无需对节点顺序进行处理，可以提高代码的复用，在后续增加卡槽时候只需将特定位置更改为1执行即可。
设计时候使用了32位卡槽，先使用第32位，在使用31位...，这样的话，对于新增模版无需更改原来模版，只需配置新模版。  

###  结论
优点:处理节点统一，增加卡槽节点时无需回归测试，只需要对新增节点进行测试即可，无需对之前业务过于了解。
缺点:前端配置时，需要后台人员对32位卡槽模版了解，学习难度比较大。

















